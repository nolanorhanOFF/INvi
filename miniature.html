<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Miniature avec texte et t√©l√©chargement</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 2rem;
  }
  select, input[type=file], button {
    padding: 10px;
    margin: 10px;
    border-radius: 8px;
    font-size: 1rem;
    border: none;
  }
  select, input[type=file] {
    background-color: #333;
    color: white;
  }
  button {
    background-color: #00ffcc;
    color: black;
    cursor: pointer;
    font-weight: bold;
  }
  canvas {
    margin-top: 1rem;
    border: 4px solid #00ffcc;
    border-radius: 10px;
    max-width: 100%;
    height: auto;
  }
  #downloadBtn {
    display: none;
    margin-top: 1rem;
    background-color: #00cc99;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1.2rem;
    border-radius: 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>üñºÔ∏è Miniature personnalis√©e & t√©l√©chargement</h1>

<input type="file" id="fileInput" accept="image/*" />
<br>

<label for="game">üéÆ Choisis un jeu :</label>
<select id="game">
  <option value="">-- Choisis --</option>
  <option value="Minecraft">Minecraft</option>
  <option value="Fortnite">Fortnite</option>
  <option value="Roblox">Roblox</option>
  <option value="Call of Duty">Call of Duty</option>
  <option value="Among Us">Among Us</option>
  <option value="GTA V">GTA V</option>
  <option value="Valorant">Valorant</option>
</select>

<label for="theme">üß† Choisis un th√®me :</label>
<select id="theme">
  <option value="">-- Choisis --</option>
  <option value="D√©fi">D√©fi</option>
  <option value="Troll">Troll</option>
  <option value="Secrets">Secrets</option>
  <option value="Hardcore">Hardcore</option>
  <option value="Mods">Mods</option>
  <option value="Build">Construction</option>
</select>

<br>

<button id="generateBtn">‚ú® Analyser & Ajouter Texte</button>

<br>

<canvas id="canvas"></canvas>
<br>
<button id="downloadBtn">‚¨áÔ∏è T√©l√©charger la miniature</button>

<script>
  const fileInput = document.getElementById('fileInput');
  const gameSelect = document.getElementById('game');
  const themeSelect = document.getElementById('theme');
  const generateBtn = document.getElementById('generateBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  let img = new Image();

  // Charger l'image upload√©e dans l'objet img
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
      img = new Image();
      img.onload = () => {
        // Redimensionner le canvas √† la taille de l'image
        canvas.width = img.width;
        canvas.height = img.height;
        // Afficher image brute au d√©part
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);
        downloadBtn.style.display = 'none'; // cacher bouton t√©l√©chargement tant que non g√©n√©r√©
      };
      img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  });

  generateBtn.addEventListener('click', () => {
    const game = gameSelect.value;
    const theme = themeSelect.value;

    if (!img.src) {
      alert("‚ö†Ô∏è Merci d'uploader une image !");
      return;
    }
    if (!game || !theme) {
      alert("‚ö†Ô∏è Merci de choisir un jeu et un th√®me !");
      return;
    }

    // Dessiner l'image sur le canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0);

    // Ajouter un overlay semi-transparent en bas
    const overlayHeight = canvas.height * 0.2;
    ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
    ctx.fillRect(0, canvas.height - overlayHeight, canvas.width, overlayHeight);

    // Ajouter texte (jeu et th√®me) centr√© dans l'overlay
    ctx.fillStyle = '#00ffcc';
    ctx.font = `bold ${Math.floor(overlayHeight / 2.5)}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    const text = `${game} - ${theme}`;
    ctx.fillText(text, canvas.width / 2, canvas.height - overlayHeight / 2);

    // Afficher bouton t√©l√©chargement
    downloadBtn.style.display = 'inline-block';
  });

  downloadBtn.addEventListener('click', () => {
    const dataUrl = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = dataUrl;
    a.download = 'miniature-personnalisee.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
</script>

</body>
</html>
