<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Miniature Minecraft styl√©e</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  body {
    background: #0c0c0c;
    color: #eee;
    font-family: 'Press Start 2P', cursive, monospace;
    text-align: center;
    padding: 2rem;
  }
  input[type=file], select, button {
    padding: 10px 15px;
    margin: 10px 5px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
    background: #222;
    color: #eee;
    transition: background 0.3s ease;
  }
  input[type=file]:hover, select:hover, button:hover {
    background: #00ffcc;
    color: #000;
    cursor: pointer;
  }
  canvas {
    margin-top: 1rem;
    border-radius: 20px;
    max-width: 100%;
    box-shadow: 0 0 30px #00ffccaa;
  }
  #downloadBtn {
    display: none;
    margin-top: 1rem;
    background-color: #00cc99;
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 1.2rem;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 0 15px #00cc99;
    transition: background 0.3s ease;
  }
  #downloadBtn:hover {
    background-color: #00ffaa;
  }
</style>
</head>
<body>

<h1>üéÆ Miniature styl√©e personnalis√©e</h1>

<input type="file" id="fileInput" accept="image/*" />
<br>

<label for="game">Choisis un jeu :</label>
<select id="game">
  <option value="">-- Choisis --</option>
  <option value="Minecraft">Minecraft</option>
  <option value="Fortnite">Fortnite</option>
  <option value="Roblox">Roblox</option>
  <option value="Call of Duty">Call of Duty</option>
  <option value="Among Us">Among Us</option>
  <option value="GTA V">GTA V</option>
  <option value="Valorant">Valorant</option>
</select>

<label for="theme">Choisis un th√®me :</label>
<select id="theme">
  <option value="">-- Choisis --</option>
  <option value="D√©fi">D√©fi</option>
  <option value="Troll">Troll</option>
  <option value="Secrets">Secrets</option>
  <option value="Hardcore">Hardcore</option>
  <option value="Mods">Mods</option>
  <option value="Build">Construction</option>
</select>

<br>

<button id="generateBtn">‚ú® G√©n√©rer la miniature styl√©e</button>

<br>

<canvas id="canvas"></canvas>
<br>
<button id="downloadBtn">‚¨áÔ∏è T√©l√©charger la miniature</button>

<script>
  const fileInput = document.getElementById('fileInput');
  const gameSelect = document.getElementById('game');
  const themeSelect = document.getElementById('theme');
  const generateBtn = document.getElementById('generateBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  let img = new Image();

  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
      img = new Image();
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);
        downloadBtn.style.display = 'none';
      };
      img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  });

  // Fonction pour dessiner des blocs pixelis√©s Minecraft en fond
  function drawMinecraftBlocks() {
    const blockSize = 30;
    const countX = Math.floor(canvas.width / blockSize);
    const countY = Math.floor(canvas.height / blockSize);

    for(let i=0; i < 60; i++) {  // dessine 60 petits blocs al√©atoires
      const x = Math.floor(Math.random() * countX) * blockSize;
      const y = Math.floor(Math.random() * countY) * blockSize;

      // Couleur ¬´ terre Minecraft ¬ª avec nuances
      const brownShades = ['#7B5A2B', '#8C6A3F', '#9A7F55'];
      const color = brownShades[Math.floor(Math.random()*brownShades.length)];

      ctx.fillStyle = color;
      ctx.fillRect(x, y, blockSize, blockSize);

      // Ombre bas droit du bloc
      ctx.fillStyle = 'rgba(0,0,0,0.3)';
      ctx.fillRect(x + blockSize*0.7, y + blockSize*0.7, blockSize*0.3, blockSize*0.3);
    }
  }

  // Fonction pour dessiner un contour au texte (stroke + fill)
  function drawTextWithOutline(text, x, y, fontSize, fillColor, strokeColor) {
    ctx.font = `bold ${fontSize}px 'Press Start 2P', cursive`;
    ctx.lineWidth = Math.floor(fontSize/10);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    ctx.strokeStyle = strokeColor;
    ctx.strokeText(text, x, y);

    ctx.fillStyle = fillColor;
    ctx.fillText(text, x, y);
  }

  // Fonction pour dessiner un petit bloc Minecraft iconique en haut gauche
  function drawMinecraftIcon(x, y, size) {
    // Bloc pixelis√© simple terre + herbe
    const grassGreen = '#4CAF50';
    const dirtBrown = '#7B5A2B';
    const shadow = 'rgba(0,0,0,0.5)';

    const pixelSize = size / 8;

    // 8x8 pixels
    for(let px=0; px<8; px++) {
      for(let py=0; py<8; py++) {
        let color = null;
        if (py < 2) {
          // Herbe en haut : 2 lignes
          color = grassGreen;
        } else {
          color = dirtBrown;
        }
        // Pour faire un effet pixel break
        if(Math.random() < 0.05) color = shadeColor(color, -30);

        ctx.fillStyle = color;
        ctx.fillRect(x + px*pixelSize, y + py*pixelSize, pixelSize, pixelSize);
      }
    }

    // Ombre l√©g√®re
    ctx.fillStyle = shadow;
    ctx.fillRect(x + size*0.7, y + size*0.7, size*0.3, size*0.3);
  }

  // Petite fonction pour assombrir une couleur (en hex)
  function shadeColor(color, percent) {
    let R = parseInt(color.substring(1,3),16);
    let G = parseInt(color.substring(3,5),16);
    let B = parseInt(color.substring(5,7),16);

    R = parseInt(R * (100 + percent) / 100);
    G = parseInt(G * (100 + percent) / 100);
    B = parseInt(B * (100 + percent) / 100);

    R = (R<255)?R:255;
    G = (G<255)?G:255;
    B = (B<255)?B:255;

    const RR = (R.toString(16).length===1) ? '0'+R.toString(16) : R.toString(16);
    const GG = (G.toString(16).length===1) ? '0'+G.toString(16) : G.toString(16);
    const BB = (B.toString(16).length===1) ? '0'+B.toString(16) : B.toString(16);

    return '#'+RR+GG+BB;
  }

  generateBtn.addEventListener('click', () => {
    const game = gameSelect.value;
    const theme = themeSelect.value;

    if (!img.src) {
      alert("‚ö†Ô∏è Merci d'uploader une image !");
      return;
    }
    if (!game || !theme) {
      alert("‚ö†Ô∏è Merci de choisir un jeu et un th√®me !");
      return;
    }

    // Dessiner l'image de base
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0);

    // Si Minecraft, dessiner des blocs pixelis√©s en fond
    if (game === 'Minecraft') {
      drawMinecraftBlocks();
      drawMinecraftIcon(20, 20, 80);
    }

    // D√©grad√© sombre en bas pour texte
    const gradHeight = canvas.height * 0.25;
    const gradient = ctx.createLinearGradient(0, canvas.height - gradHeight, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(0,0,0,0)');
    gradient.addColorStop(1, 'rgba(0,0,0,0.8)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, canvas.height - gradHeight, canvas.width, gradHeight);

    // Texte sur la miniature
    const mainText = `${game} - ${theme}`;
    const fontSize = Math.floor(canvas.height * 0.1);

    drawTextWithOutline(mainText, canvas.width / 2, canvas.height - gradHeight / 2, fontSize, '#00ffcc', '#000');

    // Afficher bouton t√©l√©chargement
    downloadBtn.style.display = 'inline-block';
  });

  downloadBtn.addEventListener('click', () => {
    const dataUrl = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = dataUrl;
    a.download = 'miniature-style.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
</script>

</body>
</html>
